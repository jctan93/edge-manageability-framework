# SPDX-FileCopyrightText: 2025 Intel Corporation
#
# SPDX-License-Identifier: Apache-2.0
apiVersion: operator.cluster.x-k8s.io/v1alpha2
kind: Provider
metadata:
  name: bootstrap-rke2
  namespace: capr-system
spec:
  type: BootstrapProvider
  version: v0.12.0
  deployment:
    kustomize:
      repoURL: https://github.com/rancher/cluster-api-provider-rke2
      ref: v0.12.0
      path: bootstrap/config/manager
      patches:
        - target:
            kind: Deployment
            name: rke2-bootstrap-controller-manager
            namespace: capr-system
          patch: |
            - op: replace
              path: /metadata/name
              value: rke2-bootstrap-controller-manager
            - op: replace
              path: /metadata/namespace
              value: capr-system
            - op: replace
              path: /spec/template/spec/serviceAccountName
              value: rke2-bootstrap-manager
            - op: replace
              path: /spec/template/spec/containers/0/image
              value: ghcr.io/rancher/cluster-api-provider-rke2-bootstrap:v0.12.0
            - op: replace
              path: /spec/template/spec/containers/0/args/1
              value: --diagnostics-address=:8080
            - op: replace
              path: /spec/template/spec/containers/0/args/2
              value: --insecure-diagnostics=true
            - op: replace
              path: /spec/template/spec/containers/0/ports/2
              value:
                containerPort: 8080
                name: metrics
                protocol: TCP
